name: Continuous Delivery pipeline for ECS backend

# Controls when the action will run.
on:
  # Triggers the workflow on repository-dispatch event
  repository_dispatch:
    types: [staging-deployment]

# This workflow is made up of one job that calls the reusable workflow in graasp-deploy
jobs:
  graasp-deploy-ecs-backend-workflow:
    # Replace with repository name
    name: CD caller template
    uses: graasp/graasp-deploy/.github/workflows/cdelivery-ecs-backend.yml@main
    # Replace input ecs-task-definition with template file. Format: '.aws/<name>-stage.json'. Replace tag.
    with:
      ecs-task-definition:
      tag: ${{ github.event.client_payload.tag }}
    # Insert required secrets based on repository with the following format: ${{ secrets.SECRET_NAME }}
    secrets:
      aws-access-key-id:
      aws-secret-access-key:
      aws-region:
      ecs-cluster:
      ecs-service:
      ecr-repository:
      container-name-graasp:
      container-name-iframely:
      container-name-classifier:
      container-image-iframely:
      container-image-classifier:
      apps-jwt-secret:
      apps-plugin:
      auth-client-host:
      auth-token-expiration-in-minutes:
      auth-token-jwt-secret:
      avatars-path-prefix:
      chatbox-plugin:
      client-host:
      cookie-domain:
      cors-origin-regex:
      database-logs:
      email-links-host:
      embedded-link-item-iframely-href-origin:
      embedded-link-item-plugin:
      file-storage-root-path:
      files-path-prefix:
      hidden-tag-id:
      hostname:
      image-classifier-api:
      jwt-secret:
      login-item-tag-id:
      mailer-config-from-email:
      mailer-config-password:
      mailer-config-smtp-host:
      mailer-config-username:
      node-env:
      node-env-container-2:
      pg-connection-uri:
      port:
      public-plugin:
      public-tag-id:
      published-tag-id:
      redis-host:
      redis-port:
      redis-username:
      refresh-token-expiration-in-minutes:
      refresh-token-jwt-secret:
      roarr-log:
      s3-file-item-access-key-id:
      s3-file-item-bucket:
      s3-file-item-access-plugin:
      s3-file-item-region:
      s3-file-item-secret-access-key:
      save-actions:
      secure-session-secret-key:
      thumbnails-path-prefix:
      token-based-auth:
      websockets-plugin:
